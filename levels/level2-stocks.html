<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Уровень 2 — Биржевой магнат | Семейный Квест</title>
  <link rel="stylesheet" href="../css/main.css">
  <style>
    /* Минимальная встраиваемая стилизация для уровня */
    body,html { height:100%; margin:0; font-family:Arial,Helvetica,sans-serif; background:#f6f9fc; color:#222; }
    header{ display:flex; align-items:center; gap:16px; padding:12px 20px; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.06); }
    main{ padding:16px; display:flex; gap:16px; height:calc(100% - 64px); box-sizing:border-box; }
    .left { flex:1 1 70%; display:flex; flex-direction:column; gap:12px; }
    .right { width:320px; background:#fff; padding:12px; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.06); overflow:auto; }
    .balances { display:flex; gap:8px; flex-wrap:wrap; }
    .balance-card { background:linear-gradient(180deg,#fff 0,#f7fbff 100%); padding:8px; border-radius:6px; min-width:140px; box-shadow:0 1px 2px rgba(0,0,0,0.04); }
    .scene { background:#fff; border-radius:8px; padding:12px; box-shadow:0 1px 6px rgba(0,0,0,0.06); display:flex; flex-direction:column; gap:12px; height:100%; }
    #chart-wrap{ flex:1 1 auto; display:flex; align-items:center; justify-content:center; min-height:360px; }
    canvas { max-width:100%; height:420px; }
    .card { background:#fff; padding:12px; border-radius:6px; }
    .controls { display:flex; flex-direction:column; gap:10px; }
    .player-action { border:1px dashed #e0e6ef; padding:8px; border-radius:6px; display:flex; gap:8px; align-items:center; justify-content:space-between; }
    .modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.4); z-index:1000; }
    .modal .box { width:900px; max-width:95%; background:#fff; padding:16px; border-radius:8px; }
    .players-list { display:flex; gap:8px; flex-wrap:wrap; margin:8px 0; }
    .players-list label{ display:flex; gap:6px; align-items:center; padding:6px 8px; background:#f4f7fb; border-radius:6px; cursor:pointer; }
    .small { font-size:13px; color:#666; }
    .btn { padding:8px 12px; border-radius:6px; background:#0078d4; color:#fff; border:none; cursor:pointer; }
    .btn.secondary { background:#e6eefc; color:#0078d4; }
    .footer-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }
    .summary-table { width:100%; border-collapse:collapse; }
    .summary-table th, .summary-table td { padding:6px; border-bottom:1px solid #eee; text-align:left; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <header>
    <a href="../index.html" id="btn-back">← Назад</a>
    <h1>Биржевой магнат</h1>
  </header>

  <main>
    <div class="left">
      <div class="scene">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <div>
            <strong id="scenario-title">Сценарий — #</strong>
            <div class="small" id="scenario-news">Новость: —</div>
          </div>
          <div>
            <button id="btn-save-exit" class="btn secondary">Сохранить и выйти</button>
            <button id="btn-next" class="btn" disabled>Следующий сценарий</button>
          </div>
        </div>

        <div id="chart-wrap">
          <canvas id="stockChart"></canvas>
        </div>

        <div class="card">
          <div class="small">Действия игроков</div>
          <div id="actions-wrapper" class="controls">
            <!-- формы для каждого игрока -->
          </div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button id="btn-reveal" class="btn">Узнать будущее</button>
            <div class="small" id="round-info">Раунд 0 / 5</div>
          </div>
        </div>
      </div>
    </div>

    <aside class="right">
      <div class="card">
        <h3>Игроки и баланс</h3>
        <div id="balances" class="balances"></div>
        <hr/>
        <div class="small">Пулы/сессии</div>
        <div id="session-list" style="margin:8px 0;"></div>
        <div style="margin-top:8px;">
          <button id="btn-new-pool" class="btn secondary">Новый пул</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <h3>Итог</h3>
        <div id="final-summary" class="hidden">
          <table class="summary-table" id="summary-table"></table>
          <div style="margin-top:8px;">
            <button id="btn-finish-save" class="btn">Завершить и сохранить результат</button>
          </div>
        </div>
        <div id="no-summary" class="small">Игра ещё не окончена</div>
      </div>
    </aside>
  </main>

  <!-- MODAL: выбор/возобновление -->
  <div id="startModal" class="modal hidden">
    <div class="box">
      <h2>Выберите участников пула</h2>
      <div class="small">Игроки из профиля</div>
      <div id="players-existing" class="players-list"></div>

      <div style="margin-top:12px;">
        <input id="new-player-name" placeholder="Имя нового игрока" />
        <button id="btn-add-player" class="btn">Добавить</button>
      </div>

      <div style="margin-top:12px;">
        <div class="small">Продолжить сохранённую сессию:</div>
        <div id="saved-sessions" style="margin:8px 0;"></div>
      </div>

      <div class="footer-actions">
        <button id="btn-cancel-start" class="btn secondary">Отмена</button>
        <button id="btn-start-game" class="btn">Начать игру</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/players.js"></script>
  <script src="../js/core/leaderboard.js"></script>
  <script src="../js/levels/level2-stocks.js"></script>
</body>
</html>
